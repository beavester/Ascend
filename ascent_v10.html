<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ascent</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --bg: #f8fafc;
            --bg2: #f1f5f9;
            --bg3: #e2e8f0;
            --card: #ffffff;
            --text: #0f172a;
            --text2: #475569;
            --text3: #94a3b8;
            --accent: #3b82f6;
            --accent-light: #dbeafe;
            --success: #22c55e;
            --success-light: #dcfce7;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --purple: #8b5cf6;
            --purple-light: #ede9fe;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
            
            /* Gamification colors */
            --ring-empty: #e2e8f0;
            --ring-progress: #3b82f6;
            --ring-complete: #22c55e;
            --ring-glow: rgba(34, 197, 94, 0.4);
            --flame-core: #f59e0b;
            --flame-outer: #ef4444;
            --heatmap-0: #e2e8f0;
            --heatmap-25: #dcfce7;
            --heatmap-50: #86efac;
            --heatmap-75: #22c55e;
            --heatmap-100: #16a34a;
            --mountain-rock: #64748b;
            --mountain-snow: #f1f5f9;
            --mountain-path: #f59e0b;
        }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); }
        
        .screen { position: fixed; inset: 0; display: none; flex-direction: column; overflow: hidden; background: var(--bg); }
        .screen.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes checkPop { 0% { transform: scale(0); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        @keyframes ringPulse { 0%, 100% { filter: drop-shadow(0 0 0 transparent); } 50% { filter: drop-shadow(0 0 8px var(--ring-glow)); } }
        @keyframes ringClose { 0% { stroke-dashoffset: var(--offset); } 100% { stroke-dashoffset: 0; } }
        
        /* Flame animation */
        @keyframes flameFlicker {
            0%, 100% { transform: scaleY(1) scaleX(1); }
            25% { transform: scaleY(1.1) scaleX(0.95); }
            50% { transform: scaleY(0.95) scaleX(1.05); }
            75% { transform: scaleY(1.05) scaleX(0.98); }
        }
        @keyframes flameGlow {
            0%, 100% { filter: drop-shadow(0 0 4px rgba(245, 158, 11, 0.6)); }
            50% { filter: drop-shadow(0 0 12px rgba(245, 158, 11, 0.9)); }
        }
        @keyframes particleRise {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-20px) scale(0); opacity: 0; }
        }
        @keyframes confetti {
            0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes badgeBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        
        /* Particle explosion */
        @keyframes particleExplode {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }
        
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 24px; border: none; border-radius: var(--radius); font-family: inherit; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--accent); color: #fff; }
        .btn-light { background: var(--bg2); color: var(--text); }
        .btn-ghost { background: transparent; color: var(--text3); }
        .btn-sm { padding: 10px 16px; font-size: 13px; }
        .btn-full { width: 100%; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .input { width: 100%; padding: 14px 16px; background: var(--card); border: 1px solid var(--bg3); border-radius: var(--radius); font-family: inherit; font-size: 15px; color: var(--text); transition: all 0.2s; }
        .input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }
        .input::placeholder { color: var(--text3); }
        .textarea { min-height: 120px; resize: none; line-height: 1.6; }
        
        /* Splash */
        #splash { background: linear-gradient(135deg, #3b82f6, #8b5cf6); justify-content: center; align-items: center; color: #fff; }
        .splash-icon { width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
        .splash-icon svg { width: 40px; height: 40px; }
        .splash-title { font-size: 32px; font-weight: 800; }
        .splash-sub { font-size: 16px; opacity: 0.9; }
        
        /* Setup screens */
        .setup { flex: 1; display: flex; flex-direction: column; }
        .setup-header { padding: 20px 24px; padding-top: max(60px, env(safe-area-inset-top)); }
        .setup-back { display: flex; align-items: center; gap: 4px; font-size: 15px; color: var(--accent); background: none; border: none; cursor: pointer; padding: 0; margin-bottom: 20px; }
        .setup-progress { display: flex; gap: 6px; margin-bottom: 24px; }
        .setup-progress-bar { flex: 1; height: 4px; background: var(--bg3); border-radius: 2px; overflow: hidden; }
        .setup-progress-fill { height: 100%; background: var(--accent); }
        .setup-title { font-size: 28px; font-weight: 800; line-height: 1.2; margin-bottom: 8px; }
        .setup-subtitle { font-size: 15px; color: var(--text2); line-height: 1.6; }
        .setup-content { flex: 1; overflow-y: auto; padding: 0 24px; padding-bottom: 100px; -webkit-overflow-scrolling: touch; }
        .setup-footer { padding: 16px 24px; padding-bottom: max(24px, env(safe-area-inset-bottom)); background: var(--card); border-top: 1px solid var(--bg3); position: sticky; bottom: 0; flex-shrink: 0; }
        
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 12px; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        
        .chip-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip { padding: 10px 16px; background: var(--bg2); border: 2px solid transparent; border-radius: var(--radius); font-size: 14px; font-weight: 500; color: var(--text2); cursor: pointer; transition: all 0.2s; }
        .chip.selected { background: var(--accent-light); border-color: var(--accent); color: var(--accent); }
        
        .time-chips { display: flex; gap: 8px; }
        .time-chip { flex: 1; padding: 16px 12px; background: var(--bg2); border: 2px solid transparent; border-radius: var(--radius); text-align: center; cursor: pointer; }
        .time-chip.selected { background: var(--accent-light); border-color: var(--accent); }
        .time-chip-label { font-size: 12px; font-weight: 600; color: var(--text2); }
        .time-chip.selected .time-chip-label { color: var(--accent); }
        
        .loading-card { background: var(--card); border-radius: var(--radius-lg); padding: 32px 24px; text-align: center; box-shadow: var(--shadow); }
        .loading-spinner { width: 48px; height: 48px; border: 3px solid var(--bg3); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 16px; }
        .loading-text { font-size: 15px; color: var(--text2); }
        
        .curriculum-card { background: var(--card); border-radius: var(--radius-lg); padding: 20px; box-shadow: var(--shadow); margin-bottom: 16px; }
        .curriculum-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
        .curriculum-icon { width: 44px; height: 44px; background: var(--accent-light); border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .curriculum-title { font-size: 18px; font-weight: 700; }
        .curriculum-meta { font-size: 13px; color: var(--text3); margin-top: 2px; }
        
        .phase { margin-bottom: 16px; }
        .phase-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        .phase-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; }
        .phase-name { font-size: 14px; font-weight: 700; color: var(--accent); }
        .phase-weeks { padding-left: 16px; border-left: 2px solid var(--bg3); }
        .week-item { padding: 10px 0 10px 12px; border-bottom: 1px solid var(--bg2); }
        .week-item:last-child { border-bottom: none; }
        .week-num { font-size: 11px; font-weight: 700; color: var(--text3); text-transform: uppercase; margin-bottom: 2px; }
        .week-milestone { font-size: 14px; color: var(--text); line-height: 1.4; }
        
        /* App */
        .app { display: flex; flex-direction: column; height: 100%; }
        .app-header { padding: 16px 20px; padding-top: max(52px, env(safe-area-inset-top)); background: var(--card); border-bottom: 1px solid var(--bg3); }
        .header-row { display: flex; justify-content: space-between; align-items: center; }
        .header-greeting { font-size: 13px; color: var(--text3); font-weight: 500; }
        .header-date { font-size: 20px; font-weight: 700; margin-top: 2px; }
        .header-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent), var(--purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 16px; }
        
        .app-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; -webkit-overflow-scrolling: touch; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DAILY COMPLETION RING - Activity Ring Style
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .daily-ring-container { background: var(--card); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 20px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 24px; }
        .daily-ring { position: relative; width: 120px; height: 120px; flex-shrink: 0; }
        .daily-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .daily-ring .ring-bg { fill: none; stroke: var(--ring-empty); stroke-width: 10; }
        .daily-ring .ring-progress { fill: none; stroke: var(--ring-progress); stroke-width: 10; stroke-linecap: round; transition: stroke-dashoffset 0.6s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.3s; }
        .daily-ring.complete .ring-progress { stroke: var(--ring-complete); animation: ringPulse 1s ease-in-out 3; }
        .daily-ring-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .daily-ring-percent { font-size: 28px; font-weight: 800; color: var(--text); }
        .daily-ring-label { font-size: 11px; font-weight: 600; color: var(--text3); text-transform: uppercase; }
        .daily-ring-info { flex: 1; }
        .daily-ring-title { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
        .daily-ring-subtitle { font-size: 13px; color: var(--text3); line-height: 1.5; }
        .daily-ring-stats { display: flex; gap: 16px; margin-top: 12px; }
        .daily-ring-stat { font-size: 13px; color: var(--text2); }
        .daily-ring-stat strong { color: var(--text); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STREAK FLAME - Animated Fire Counter
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .streak-card { background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px; display: flex; align-items: center; gap: 16px; position: relative; overflow: hidden; }
        .streak-flame-container { position: relative; width: 60px; height: 70px; display: flex; align-items: flex-end; justify-content: center; }
        .streak-flame { animation: flameFlicker 0.5s ease-in-out infinite, flameGlow 1s ease-in-out infinite; transform-origin: bottom center; }
        .streak-flame svg { width: 50px; height: 60px; }
        .streak-flame.small svg { width: 35px; height: 45px; }
        .streak-flame.medium svg { width: 45px; height: 55px; }
        .streak-flame.large svg { width: 55px; height: 65px; }
        .streak-flame.epic svg { width: 60px; height: 70px; }
        .flame-particles { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); pointer-events: none; }
        .flame-particle { position: absolute; width: 6px; height: 6px; background: var(--flame-core); border-radius: 50%; animation: particleRise 1s ease-out infinite; opacity: 0; }
        .flame-particle:nth-child(1) { left: -8px; animation-delay: 0s; }
        .flame-particle:nth-child(2) { left: 0px; animation-delay: 0.3s; }
        .flame-particle:nth-child(3) { left: 8px; animation-delay: 0.6s; }
        .streak-info { flex: 1; }
        .streak-number { font-size: 36px; font-weight: 800; color: var(--text); line-height: 1; }
        .streak-label { font-size: 14px; font-weight: 600; color: var(--text2); margin-top: 2px; }
        .streak-message { font-size: 12px; color: var(--text2); margin-top: 8px; padding: 6px 10px; background: rgba(255,255,255,0.6); border-radius: 6px; display: inline-block; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOUNTAIN ASCENT - Long-term Progress Visualization
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .mountain-card { background: linear-gradient(180deg, #e0f2fe 0%, #f0f9ff 50%, var(--card) 100%); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow); overflow: hidden; }
        .mountain-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .mountain-title { font-size: 14px; font-weight: 700; color: var(--text); }
        .mountain-progress-text { font-size: 12px; color: var(--text3); }
        .mountain-visual { position: relative; height: 180px; }
        .mountain-svg { width: 100%; height: 100%; }
        .mountain-path { fill: none; stroke: var(--mountain-path); stroke-width: 3; stroke-linecap: round; stroke-dasharray: 5, 5; }
        .mountain-path-walked { fill: none; stroke: var(--success); stroke-width: 4; stroke-linecap: round; }
        .camp-marker { cursor: pointer; }
        .camp-marker circle { transition: all 0.2s; }
        .camp-marker.unlocked circle { fill: var(--success); }
        .camp-marker.current circle { fill: var(--accent); filter: drop-shadow(0 0 6px var(--accent)); }
        .camp-marker text { font-size: 8px; font-weight: 700; fill: var(--text3); }
        .camp-marker.unlocked text, .camp-marker.current text { fill: var(--text); }
        .climber-icon { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .mountain-legend { display: flex; justify-content: space-between; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--bg3); }
        .mountain-camp { text-align: center; flex: 1; }
        .mountain-camp-icon { width: 24px; height: 24px; margin: 0 auto 4px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        .mountain-camp-icon.locked { background: var(--bg3); color: var(--text3); }
        .mountain-camp-icon.unlocked { background: var(--success); color: #fff; }
        .mountain-camp-icon.current { background: var(--accent); color: #fff; }
        .mountain-camp-name { font-size: 10px; font-weight: 600; color: var(--text3); }
        .mountain-camp.unlocked .mountain-camp-name { color: var(--text); }
        .mountain-camp-day { font-size: 9px; color: var(--text3); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           GITHUB-STYLE HEAT MAP
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .heatmap-card { background: var(--card); border-radius: var(--radius-lg); padding: 16px; margin-bottom: 20px; box-shadow: var(--shadow); }
        .heatmap-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .heatmap-title { font-size: 14px; font-weight: 700; color: var(--text); }
        .heatmap-legend { display: flex; align-items: center; gap: 4px; font-size: 10px; color: var(--text3); }
        .heatmap-legend-box { width: 10px; height: 10px; border-radius: 2px; }
        .heatmap-days-header { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 4px; }
        .heatmap-days-header span { font-size: 10px; font-weight: 600; color: var(--text3); text-align: center; }
        .heatmap-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .heatmap-cell { aspect-ratio: 1; border-radius: 3px; position: relative; cursor: pointer; transition: transform 0.1s; }
        .heatmap-cell:hover { transform: scale(1.2); z-index: 1; }
        .heatmap-cell.empty { background: transparent; cursor: default; }
        .heatmap-cell.empty:hover { transform: none; }
        .heatmap-cell.future { background: var(--bg2); opacity: 0.5; }
        .heatmap-cell.level-0 { background: var(--heatmap-0); }
        .heatmap-cell.level-1 { background: var(--heatmap-25); }
        .heatmap-cell.level-2 { background: var(--heatmap-50); }
        .heatmap-cell.level-3 { background: var(--heatmap-75); }
        .heatmap-cell.level-4 { background: var(--heatmap-100); }
        .heatmap-cell.today { outline: 2px solid var(--accent); outline-offset: 1px; }
        .heatmap-tooltip { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: var(--text); color: #fff; font-size: 10px; padding: 4px 8px; border-radius: 4px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 10; }
        .heatmap-cell:hover .heatmap-tooltip { opacity: 1; }
        
        /* Week info card */
        .week-info { background: var(--card); border-radius: var(--radius-lg); padding: 16px; margin-bottom: 20px; box-shadow: var(--shadow); }
        .week-info-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .week-info-label { font-size: 11px; font-weight: 700; color: var(--text3); text-transform: uppercase; }
        .week-info-num { font-size: 12px; font-weight: 600; color: var(--accent); background: var(--accent-light); padding: 4px 10px; border-radius: 20px; }
        .week-milestone-text { font-size: 15px; font-weight: 600; color: var(--text); line-height: 1.4; }
        
        /* Section header */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; margin-top: 8px; }
        .section-title { font-size: 12px; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; }
        .section-action { font-size: 13px; font-weight: 600; color: var(--accent); cursor: pointer; }
        
        /* Task/Habit cards */
        .task-card { background: var(--card); border-radius: var(--radius); padding: 16px; margin-bottom: 10px; box-shadow: var(--shadow); position: relative; overflow: hidden; }
        .task-card.completed { opacity: 0.6; }
        .task-header { display: flex; align-items: flex-start; gap: 12px; }
        .task-check { width: 26px; height: 26px; border: 2px solid var(--bg3); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; position: relative; }
        .task-check:hover { border-color: var(--success); }
        .task-check.done { background: var(--success); border-color: var(--success); }
        .task-check svg { width: 14px; height: 14px; stroke: #fff; stroke-width: 3; opacity: 0; }
        .task-check.done svg { opacity: 1; animation: checkPop 0.3s; }
        .task-content { flex: 1; }
        .task-text { font-size: 15px; font-weight: 500; color: var(--text); line-height: 1.4; }
        .task-meta { display: flex; align-items: center; gap: 8px; margin-top: 6px; font-size: 12px; color: var(--text3); }
        .task-tag { padding: 2px 8px; background: var(--bg2); border-radius: 4px; font-weight: 600; }
        .task-tag.ai { background: var(--purple-light); color: var(--purple); }
        
        .task-actions { display: flex; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--bg2); }
        .task-btn { display: flex; align-items: center; gap: 6px; padding: 8px 12px; background: var(--bg2); border: none; border-radius: var(--radius); font-size: 12px; font-weight: 600; color: var(--text2); cursor: pointer; transition: all 0.2s; }
        .task-btn:hover { background: var(--bg3); }
        .task-btn.primary { background: var(--accent); color: #fff; }
        .task-btn.cant-start { background: var(--warning-light); color: var(--warning); }
        .task-btn:disabled { opacity: 0.5; }
        
        .two-min-popup { background: var(--warning-light); border: 2px solid var(--warning); border-radius: var(--radius); padding: 14px; margin-top: 12px; animation: slideUp 0.3s; }
        .two-min-badge { font-size: 11px; font-weight: 700; color: var(--warning); text-transform: uppercase; margin-bottom: 8px; }
        .two-min-text { font-size: 14px; font-weight: 600; color: var(--text); line-height: 1.4; }
        .two-min-why { font-size: 12px; color: var(--text2); margin-top: 6px; font-style: italic; }
        .two-min-actions { display: flex; gap: 8px; margin-top: 10px; }
        
        .habit-card { background: var(--card); border-radius: var(--radius); padding: 14px 16px; margin-bottom: 10px; box-shadow: var(--shadow); position: relative; }
        .habit-row { display: flex; align-items: center; gap: 12px; }
        .habit-check { width: 24px; height: 24px; border: 2px solid var(--bg3); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
        .habit-check.done { background: var(--success); border-color: var(--success); }
        .habit-check svg { width: 12px; height: 12px; stroke: #fff; stroke-width: 3; opacity: 0; }
        .habit-check.done svg { opacity: 1; }
        .habit-info { flex: 1; }
        .habit-name { font-size: 14px; font-weight: 600; color: var(--text); }
        .habit-meta { font-size: 12px; color: var(--text3); margin-top: 2px; }
        .habit-streak { display: flex; align-items: center; gap: 4px; font-size: 12px; font-weight: 700; color: var(--warning); }
        .habit-2min { padding: 6px 10px; background: var(--warning-light); border: none; border-radius: 6px; font-size: 11px; font-weight: 700; color: var(--warning); cursor: pointer; }
        
        .add-btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 16px; background: var(--bg2); border: none; border-radius: var(--radius); color: var(--text2); font-size: 13px; font-weight: 600; cursor: pointer; margin-top: 12px; transition: all 0.2s; }
        .add-btn:hover { background: var(--bg3); color: var(--accent); }
        
        /* Tab bar */
        .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); border-top: 1px solid var(--bg3); padding: 8px 0; padding-bottom: max(8px, env(safe-area-inset-bottom)); display: flex; justify-content: space-around; z-index: 100; }
        .tab-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 16px; background: none; border: none; cursor: pointer; color: var(--text3); }
        .tab-item.active { color: var(--accent); }
        .tab-item svg { width: 22px; height: 22px; }
        .tab-label { font-size: 11px; font-weight: 500; }
        
        /* Particle container for explosions */
        .particles-container { position: fixed; inset: 0; pointer-events: none; z-index: 9999; overflow: hidden; }
        .particle { position: absolute; width: 8px; height: 8px; border-radius: 50%; animation: particleExplode 0.6s ease-out forwards; }
        
        /* Celebration overlay */
        .celebration { position: fixed; inset: 0; background: linear-gradient(135deg, var(--success), #16a34a); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
        .celebration.active { display: flex; animation: fadeIn 0.3s; }
        .celebration-icon { width: 80px; height: 80px; border: 3px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; animation: badgeBounce 0.5s ease-out; }
        .celebration-title { font-size: 28px; font-weight: 800; }
        .celebration-sub { font-size: 16px; opacity: 0.9; margin-top: 4px; }
        
        /* Milestone modal */
        .milestone-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .milestone-modal.active { display: flex; animation: fadeIn 0.3s; }
        .milestone-content { background: var(--card); border-radius: var(--radius-xl); padding: 32px; text-align: center; max-width: 320px; animation: slideUp 0.4s ease-out; }
        .milestone-badge { width: 80px; height: 80px; margin: 0 auto 20px; animation: badgeBounce 0.6s ease-out; }
        .milestone-badge svg { width: 100%; height: 100%; }
        .milestone-title { font-size: 24px; font-weight: 800; color: var(--text); margin-bottom: 8px; }
        .milestone-subtitle { font-size: 14px; color: var(--text2); line-height: 1.6; margin-bottom: 24px; }
        .milestone-btn { width: 100%; }
        
        /* Confetti */
        .confetti { position: fixed; width: 10px; height: 10px; top: -10px; animation: confetti 3s linear forwards; z-index: 3001; pointer-events: none; }
        
        .mini-spinner { width: 14px; height: 14px; border: 2px solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite; }
        
        /* Plan card */
        .plan-card { background: var(--card); border-radius: var(--radius-lg); padding: 20px; box-shadow: var(--shadow); margin-bottom: 16px; }
        .plan-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
        .plan-icon { width: 40px; height: 40px; background: var(--accent-light); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .plan-title { font-size: 16px; font-weight: 700; }
        .plan-meta { font-size: 13px; color: var(--text3); margin-top: 2px; }
        .day-task { display: flex; align-items: flex-start; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--bg2); }
        .day-task:last-child { border-bottom: none; }
        .day-num { width: 32px; height: 32px; background: var(--bg2); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: var(--text3); }
        .day-num.today { background: var(--accent); color: #fff; }
        .day-num.done { background: var(--success); color: #fff; }
        .day-content { flex: 1; }
        .day-label { font-size: 11px; font-weight: 600; color: var(--text3); text-transform: uppercase; margin-bottom: 2px; }
        .day-text { font-size: 14px; color: var(--text); line-height: 1.4; }
        
        /* Info button */
        .info-btn { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: var(--bg3); border: none; border-radius: 50%; cursor: pointer; margin-left: 6px; color: var(--text3); transition: all 0.2s; vertical-align: middle; }
        .info-btn:hover { background: var(--accent); color: #fff; }
        .info-btn svg { width: 12px; height: 12px; }
        
        /* Info modal */
        .info-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .info-modal.active { display: flex; animation: fadeIn 0.2s; }
        .info-modal-content { background: var(--card); border-radius: var(--radius-lg); padding: 24px; max-width: 320px; animation: slideUp 0.3s ease-out; }
        .info-modal-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
        .info-modal-icon { font-size: 28px; }
        .info-modal-title { font-size: 18px; font-weight: 700; color: var(--text); }
        .info-modal-body { font-size: 14px; color: var(--text2); line-height: 1.6; }
        .info-modal-body p { margin-bottom: 12px; }
        .info-modal-body p:last-child { margin-bottom: 0; }
        .info-modal-source { font-size: 11px; color: var(--text3); margin-top: 12px; font-style: italic; }
        .info-modal-close { width: 100%; margin-top: 20px; }
        
        /* Mini-ring calendar */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .calendar-cell { position: relative; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .calendar-cell.empty { cursor: default; }
        .calendar-cell-ring { position: absolute; inset: 0; }
        .calendar-cell-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .calendar-cell-ring .ring-bg { fill: none; stroke: var(--bg3); stroke-width: 3; }
        .calendar-cell-ring .ring-fill { fill: none; stroke: var(--success); stroke-width: 3; stroke-linecap: round; transition: stroke-dashoffset 0.3s; }
        .calendar-cell-ring.future .ring-bg { stroke: var(--bg2); opacity: 0.5; }
        .calendar-cell-ring.complete .ring-fill { stroke: var(--success); }
        .calendar-cell-ring.today { filter: drop-shadow(0 0 4px var(--accent)); }
        .calendar-cell-ring.today .ring-bg { stroke: var(--accent-light); }
        .calendar-cell-date { position: relative; z-index: 1; font-size: 9px; font-weight: 700; color: var(--text2); }
        .calendar-cell.today .calendar-cell-date { color: var(--accent); }
        .calendar-cell.complete .calendar-cell-date { color: var(--success); }
        .calendar-cell:hover .calendar-tooltip { opacity: 1; }
        .calendar-tooltip { position: absolute; bottom: calc(100% + 4px); left: 50%; transform: translateX(-50%); background: var(--text); color: #fff; font-size: 10px; padding: 4px 8px; border-radius: 4px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 10; }
    </style>
</head>
<body>
    <div id="app"></div>
    <div class="particles-container" id="particles"></div>
    
    <script>
    // Icons
    const Icons = {
        mountain: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3l4 8 5-5 5 14H2L8 3z"/></svg>',
        target: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>',
        check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>',
        plus: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>',
        x: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>',
        chevronLeft: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>',
        chevronRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>',
        clock: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>',
        flame: '<svg viewBox="0 0 24 24" fill="none" stroke-width="0"><defs><linearGradient id="flameGrad" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" style="stop-color:#f59e0b"/><stop offset="100%" style="stop-color:#ef4444"/></linearGradient></defs><path fill="url(#flameGrad)" d="M12 2C8.5 6 4 10 4 14a8 8 0 0016 0c0-4-4.5-8-8-12zm0 18a6 6 0 01-6-6c0-3 3-6 6-9 3 3 6 6 6 9a6 6 0 01-6 6z"/><path fill="#fbbf24" d="M12 20a4 4 0 01-4-4c0-2 2-4 4-6 2 2 4 4 4 6a4 4 0 01-4 4z"/></svg>',
        zap: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
        user: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>',
        calendar: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>',
        award: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89L17 22l-5-3-5 3 1.523-9.11"/></svg>',
        flag: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>',
        sunrise: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 18a5 5 0 00-10 0M12 9V2M4.22 10.22l1.42 1.42M1 18h2M21 18h2M18.36 11.64l1.42-1.42M23 22H1M16 5l-4 4-4-4"/></svg>',
        sun: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',
        moon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>',
        tent: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M12 3l9 18H3L12 3zM12 3v18"/></svg>',
        info: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>'
    };
    
    // Milestones configuration
    const MILESTONES = [
        { day: 1, name: 'Base Camp', icon: 'ğŸ•ï¸', message: 'The journey begins!' },
        { day: 7, name: 'Camp 1', icon: 'â›º', message: 'First week complete! The habit is taking root.' },
        { day: 14, name: 'Camp 2', icon: 'ğŸ”ï¸', message: 'Two weeks strong! You\'re building momentum.' },
        { day: 30, name: 'Camp 3', icon: 'ğŸ¯', message: 'One month! The habit is forming.' },
        { day: 45, name: 'Camp 4', icon: 'â­', message: 'Almost there! The summit is in sight.' },
        { day: 60, name: 'Summit', icon: 'ğŸ†', message: 'AUTOPILOT ACHIEVED! You did it!' }
    ];
    
    // LLM Config (same as before)
    const LLM_CONFIG = {
        systemPrompts: {
            curriculum: `You are a curriculum designer. You break ambitious goals into phased weekly plans. Output valid JSON only.`,
            dailyTasks: `You break weekly milestones into daily tasks. Output valid JSON only. Each task: 1 sentence, <12 words, starts with a verb.`,
            twoMinute: `You create 2-minute starter versions of tasks. Output valid JSON only. Make it embarrassingly easy.`,
            twoMinuteHabit: `You create 2-minute starter versions of habits. Output valid JSON only. Focus on just starting.`
        }
    };
    
    // AI Mock (simplified)
    const AscentAI = {
        async generateCurriculum(params) {
            await new Promise(r => setTimeout(r, 1500));
            return {
                title: "Your 8-Week Journey",
                totalWeeks: 8,
                phases: [
                    { name: "Foundation", weeks: [{ week: 1, milestone: "Learn fundamentals and set up environment." }, { week: 2, milestone: "Practice basic skills for 20 minutes daily." }]},
                    { name: "Building", weeks: [{ week: 3, milestone: "Complete your first small project." }, { week: 4, milestone: "Identify and fix gaps in understanding." }]},
                    { name: "Application", weeks: [{ week: 5, milestone: "Apply skills to real-world scenario." }, { week: 6, milestone: "Get feedback and iterate." }]},
                    { name: "Mastery", weeks: [{ week: 7, milestone: "Take on challenging project independently." }, { week: 8, milestone: "Demonstrate your skills to others." }]}
                ]
            };
        },
        async generateDailyTasks(params) {
            await new Promise(r => setTimeout(r, 1000));
            return { tasks: [
                { day: 1, task: "Review material and set today's focus." },
                { day: 2, task: "Practice core skills for 30 minutes." },
                { day: 3, task: "Apply learning to a small challenge." },
                { day: 4, task: "Review weak areas and practice them." },
                { day: 5, task: "Complete a mini-project." },
                { day: 6, task: "Rest and review week's notes." },
                { day: 7, task: "Plan next week's approach." }
            ]};
        },
        async generateTwoMinute(params) {
            await new Promise(r => setTimeout(r, 500));
            return { twoMinuteVersion: `Just open the app and do the first step of "${params.task}".`, whyThisWorks: "Starting is the hardest part; momentum takes over." };
        },
        async generateTwoMinuteHabit(params) {
            await new Promise(r => setTimeout(r, 500));
            return { twoMinuteVersion: `Do just 2 minutes of ${params.habitName}. That's it.`, whyThisWorks: "Showing up matters more than duration." };
        }
    };
    
    // Particle Effects
    const Particles = {
        explode(x, y, colors = ['#22c55e', '#fbbf24', '#3b82f6']) {
            const container = document.getElementById('particles');
            const count = 12;
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const angle = (i / count) * Math.PI * 2;
                const distance = 40 + Math.random() * 30;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                particle.style.cssText = `left:${x}px;top:${y}px;background:${colors[i % colors.length]};--tx:${tx}px;--ty:${ty}px;`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 600);
            }
        },
        
        confetti() {
            const colors = ['#ef4444', '#f59e0b', '#22c55e', '#3b82f6', '#8b5cf6'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.cssText = `left:${Math.random()*100}%;background:${colors[Math.floor(Math.random()*colors.length)]};animation-duration:${2+Math.random()*2}s;`;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }
    };
    
    // App
    const App = {
        state: { screen: 'splash', activeTab: 'today', generating: false, twoMinOpen: {}, twoMinLoading: {}, showMilestone: null, show60DaysInfo: false },
        data: { name: '', goal: '', goalContext: '', currentLevel: 'beginner', weeksAvailable: 8, curriculum: null, currentWeek: 1, dailyTasks: [], habits: [], completions: [], taskCompletions: [], streakDays: 0, unlockedMilestones: [] },
        
        init() {
            this.loadData();
            this.render();
            if (this.state.screen === 'splash') {
                setTimeout(() => { this.state.screen = this.data.curriculum ? 'app' : 'onboarding'; this.render(); }, 1500);
            }
        },
        
        loadData() {
            const saved = localStorage.getItem('ascent_v10');
            if (saved) this.data = { ...this.data, ...JSON.parse(saved) };
        },
        
        saveData() { localStorage.setItem('ascent_v10', JSON.stringify(this.data)); },
        
        render() {
            document.getElementById('app').innerHTML = this.getScreen();
            this.attachEvents();
        },
        
        getScreen() {
            switch(this.state.screen) {
                case 'splash': return this.splashScreen();
                case 'onboarding': return this.onboardingScreen();
                case 'setup-goal': return this.setupGoalScreen();
                case 'setup-context': return this.setupContextScreen();
                case 'setup-curriculum': return this.setupCurriculumScreen();
                case 'setup-habits': return this.setupHabitsScreen();
                case 'weekly-plan': return this.weeklyPlanScreen();
                case 'app': return this.appScreen();
                default: return this.splashScreen();
            }
        },
        
        splashScreen() {
            return `<div class="screen active" id="splash"><div class="splash-icon">${Icons.mountain}</div><div class="splash-title">Ascent</div><div class="splash-sub">Structure your goals</div></div>`;
        },
        
        onboardingScreen() {
            return `<div class="screen active"><div class="setup"><div class="setup-header" style="text-align:center;padding-top:max(80px, env(safe-area-inset-top));"><div style="font-size:48px;margin-bottom:16px;">ğŸ”ï¸</div><h1 class="setup-title" style="font-size:32px;">Welcome to Ascent</h1><p class="setup-subtitle" style="max-width:280px;margin:0 auto;">Turn ambitious goals into daily actions. Build habits that stick.</p></div><div class="setup-content" style="display:flex;flex-direction:column;justify-content:center;"><div style="background:var(--card);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow);margin-bottom:20px;"><div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;"><div style="width:40px;height:40px;background:var(--accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;">${Icons.target}</div><div><div style="font-size:14px;font-weight:700;color:var(--text);">AI-Powered Curriculum</div><div style="font-size:12px;color:var(--text3);">Break big goals into weekly milestones</div></div></div><div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;"><div style="width:40px;height:40px;background:var(--warning-light);border-radius:10px;display:flex;align-items:center;justify-content:center;">${Icons.zap}</div><div><div style="font-size:14px;font-weight:700;color:var(--text);">2-Minute Rule</div><div style="font-size:12px;color:var(--text3);">Can't start? Get a tiny version</div></div></div><div style="display:flex;align-items:center;gap:12px;"><div style="width:40px;height:40px;background:var(--success-light);border-radius:10px;display:flex;align-items:center;justify-content:center;">${Icons.flame}</div><div><div style="font-size:14px;font-weight:700;color:var(--text);">60-Day Autopilot</div><div style="font-size:12px;color:var(--text3);">Build habits until they're effortless</div></div></div></div><div class="form-group"><label class="form-label">What should we call you?</label><input type="text" class="input" id="name-input" placeholder="Your name" value="${this.data.name}"></div></div><div class="setup-footer"><button class="btn btn-primary btn-full" id="onboarding-next">Get Started</button></div></div></div>`;
        },
        
        setupGoalScreen() {
            return `<div class="screen active"><div class="setup"><div class="setup-header"><button class="setup-back" id="goal-back">${Icons.chevronLeft} Back</button><div class="setup-progress"><div class="setup-progress-bar"><div class="setup-progress-fill" style="width:25%"></div></div></div><h1 class="setup-title">What do you want to achieve?</h1><p class="setup-subtitle">Not a habitâ€”a destination.</p></div><div class="setup-content"><div class="form-group"><label class="form-label">Your Goal</label><textarea class="input textarea" id="goal-input" placeholder="e.g., Become conversational in Spanish">${this.data.goal}</textarea></div><div class="form-group"><label class="form-label">Current Level</label><div class="chip-group"><div class="chip ${this.data.currentLevel==='beginner'?'selected':''}" data-level="beginner">Beginner</div><div class="chip ${this.data.currentLevel==='intermediate'?'selected':''}" data-level="intermediate">Intermediate</div><div class="chip ${this.data.currentLevel==='advanced'?'selected':''}" data-level="advanced">Advanced</div></div></div><div class="form-group"><label class="form-label">Timeframe</label><div class="chip-group"><div class="chip ${this.data.weeksAvailable===4?'selected':''}" data-weeks="4">4 weeks</div><div class="chip ${this.data.weeksAvailable===8?'selected':''}" data-weeks="8">8 weeks</div><div class="chip ${this.data.weeksAvailable===12?'selected':''}" data-weeks="12">12 weeks</div></div></div></div><div class="setup-footer"><button class="btn btn-primary btn-full" id="goal-next">Continue</button></div></div></div>`;
        },
        
        setupContextScreen() {
            return `<div class="screen active"><div class="setup"><div class="setup-header"><button class="setup-back" id="context-back">${Icons.chevronLeft} Back</button><div class="setup-progress"><div class="setup-progress-bar"><div class="setup-progress-fill" style="width:50%"></div></div></div><h1 class="setup-title">Any context?</h1><p class="setup-subtitle">Helps personalize your curriculum.</p></div><div class="setup-content"><div class="form-group"><label class="form-label">Context (Optional)</label><textarea class="input textarea" id="context-input" placeholder="e.g., I have 30 minutes in the morning...">${this.data.goalContext}</textarea></div><div class="form-group"><label class="form-label">Best Time</label><div class="time-chips"><div class="time-chip selected" data-time="morning"><div class="time-chip-label">Morning</div></div><div class="time-chip" data-time="afternoon"><div class="time-chip-label">Afternoon</div></div><div class="time-chip" data-time="evening"><div class="time-chip-label">Evening</div></div></div></div></div><div class="setup-footer"><button class="btn btn-primary btn-full" id="context-next">Generate Curriculum</button></div></div></div>`;
        },
        
        setupCurriculumScreen() {
            const c = this.data.curriculum;
            return `<div class="screen active"><div class="setup"><div class="setup-header"><button class="setup-back" id="curriculum-back">${Icons.chevronLeft} Back</button><div class="setup-progress"><div class="setup-progress-bar"><div class="setup-progress-fill" style="width:75%"></div></div></div><h1 class="setup-title">${this.state.generating?'Building...':'Your Curriculum'}</h1></div><div class="setup-content">${this.state.generating?`<div class="loading-card"><div class="loading-spinner"></div><div class="loading-text">Generating...</div></div>`:c?`<div class="curriculum-card"><div class="curriculum-header"><div class="curriculum-icon">${Icons.award}</div><div><div class="curriculum-title">${c.title}</div><div class="curriculum-meta">${c.totalWeeks} weeks Â· ${c.phases.length} phases</div></div></div>${c.phases.map(p=>`<div class="phase"><div class="phase-header"><div class="phase-dot"></div><div class="phase-name">${p.name}</div></div><div class="phase-weeks">${p.weeks.map(w=>`<div class="week-item"><div class="week-num">Week ${w.week}</div><div class="week-milestone">${w.milestone}</div></div>`).join('')}</div></div>`).join('')}</div>`:''}</div><div class="setup-footer"><button class="btn btn-primary btn-full" id="curriculum-next" ${this.state.generating?'disabled':''}>${this.state.generating?'Generating...':'Continue'}</button></div></div></div>`;
        },
        
        setupHabitsScreen() {
            return `<div class="screen active"><div class="setup"><div class="setup-header"><button class="setup-back" id="habits-back">${Icons.chevronLeft} Back</button><div class="setup-progress"><div class="setup-progress-bar"><div class="setup-progress-fill" style="width:100%"></div></div></div><h1 class="setup-title">Add daily habits</h1></div><div class="setup-content">${this.data.habits.map((h,i)=>`<div class="habit-card"><div class="habit-row"><div class="habit-info"><div class="habit-name">${h.name}</div><div class="habit-meta">${h.goalAmount} ${h.unit}</div></div><button class="btn btn-ghost btn-sm" data-remove-habit="${i}">${Icons.x}</button></div></div>`).join('')}<div class="form-group" style="margin-top:20px;"><label class="form-label">Add Habit</label><input type="text" class="input" id="habit-name-input" placeholder="e.g., Exercise, Read"></div><div style="display:flex;gap:12px;"><div class="form-group" style="flex:1;"><label class="form-label">Amount</label><input type="number" class="input" id="habit-amount-input" value="30"></div><div class="form-group" style="flex:1;"><label class="form-label">Unit</label><select class="input" id="habit-unit-input"><option value="minutes">minutes</option><option value="times">times</option><option value="pages">pages</option></select></div></div><button class="btn btn-light" id="add-habit-btn" style="margin-top:8px;">${Icons.plus} Add Habit</button></div><div class="setup-footer"><button class="btn btn-primary btn-full" id="habits-done">Start Journey</button></div></div></div>`;
        },
        
        weeklyPlanScreen() {
            const c = this.data.curriculum, cw = this.data.currentWeek;
            let wm = "Complete this week's tasks";
            if(c) for(const p of c.phases){ const w=p.weeks.find(w=>w.week===cw); if(w){wm=w.milestone;break;}}
            const tasks = this.data.dailyTasks, dn=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'], td=new Date().getDay();
            return `<div class="screen active"><div class="setup"><div class="setup-header"><button class="setup-back" id="plan-back">${Icons.chevronLeft} Back</button><h1 class="setup-title">Week ${cw} Plan</h1><p class="setup-subtitle">${wm}</p></div><div class="setup-content">${this.state.generating?`<div class="loading-card"><div class="loading-spinner"></div><div class="loading-text">Breaking down...</div></div>`:`<div class="plan-card"><div class="plan-header"><div class="plan-icon">${Icons.calendar}</div><div><div class="plan-title">Daily Tasks</div><div class="plan-meta">${tasks.length} tasks</div></div></div>${tasks.map((t,i)=>{const it=i===td,done=this.data.taskCompletions.includes(`week${cw}-day${t.day}`);return`<div class="day-task"><div class="day-num ${it?'today':''} ${done?'done':''}">${t.day}</div><div class="day-content"><div class="day-label">${dn[i]||'Day '+t.day}</div><div class="day-text">${t.task}</div></div></div>`;}).join('')}</div>`}</div><div class="setup-footer"><button class="btn btn-primary btn-full" id="plan-done" ${this.state.generating?'disabled':''}>Go to Today</button></div></div></div>`;
        },
        
        appScreen() {
            const tab = this.state.activeTab;
            let content = '';
            if(tab==='today') content = this.todayTab();
            else if(tab==='plan') content = this.planTab();
            else content = this.profileTab();
            
            const hour = new Date().getHours(), greeting = hour<12?'Good morning':hour<17?'Good afternoon':'Good evening';
            const dateStr = new Date().toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'});
            
            return `<div class="screen active"><div class="app"><div class="app-header"><div class="header-row"><div><div class="header-greeting">${greeting}</div><div class="header-date">${dateStr}</div></div><div class="header-avatar">${(this.data.name||'U')[0].toUpperCase()}</div></div></div><div class="app-content">${content}</div><div class="tab-bar"><button class="tab-item ${tab==='today'?'active':''}" data-tab="today">${Icons.clock}<span class="tab-label">Today</span></button><button class="tab-item ${tab==='plan'?'active':''}" data-tab="plan">${Icons.calendar}<span class="tab-label">Plan</span></button><button class="tab-item ${tab==='profile'?'active':''}" data-tab="profile">${Icons.user}<span class="tab-label">You</span></button></div></div>${this.celebrationOverlay()}${this.milestoneModal()}${this.info60DaysModal()}</div>`;
        },
        
        todayTab() {
            const today = new Date(), todayStr = today.toDateString();
            const streak = this.data.streakDays;
            
            // Calculate today's completion
            const todayHabitsDone = new Set(this.data.completions.filter(c=>new Date(c.date).toDateString()===todayStr&&c.completed).map(c=>c.odHabitId)).size;
            const todayTaskDone = this.data.taskCompletions.some(t=>t.includes(`week${this.data.currentWeek}-day${today.getDay()}`));
            const totalItems = this.data.habits.length + (this.data.dailyTasks.length>0?1:0);
            const completedItems = todayHabitsDone + (todayTaskDone?1:0);
            const dayProgress = totalItems>0?Math.round((completedItems/totalItems)*100):0;
            const ringComplete = dayProgress===100;
            
            // Ring math
            const circumference = 2*Math.PI*52;
            const ringOffset = circumference - (dayProgress/100)*circumference;
            
            // Flame size
            let flameSize = 'small';
            if(streak>=7) flameSize = 'medium';
            if(streak>=14) flameSize = 'large';
            if(streak>=30) flameSize = 'epic';
            
            // Streak message
            let streakMsg = 'Light the flame!';
            if(streak>=1) streakMsg = 'Keep it burning!';
            if(streak>=7) streakMsg = 'One week strong!';
            if(streak>=14) streakMsg = 'Two weeks! ğŸ”¥';
            if(streak>=30) streakMsg = 'On fire!';
            if(streak>=60) streakMsg = 'LEGENDARY!';
            
            // Heat map
            const heatmapHtml = this.renderHeatmap();
            
            // Mountain
            const mountainHtml = this.renderMountain();
            
            // Current milestone & week info
            const c = this.data.curriculum, cw = this.data.currentWeek;
            let wm = "Complete your tasks";
            if(c) for(const p of c.phases){ const w=p.weeks.find(w=>w.week===cw); if(w){wm=w.milestone;break;}}
            
            // Today's task
            const todayTask = this.data.dailyTasks[today.getDay()];
            const todayTaskId = `week${cw}-day${today.getDay()}`;
            const taskDone = this.data.taskCompletions.includes(todayTaskId);
            const twoMinOpen = this.state.twoMinOpen[todayTaskId];
            const twoMinLoading = this.state.twoMinLoading[todayTaskId];
            
            return `
                <!-- DAILY COMPLETION RING -->
                <div class="daily-ring-container">
                    <div class="daily-ring ${ringComplete?'complete':''}">
                        <svg viewBox="0 0 120 120">
                            <circle class="ring-bg" cx="60" cy="60" r="52"/>
                            <circle class="ring-progress" cx="60" cy="60" r="52" stroke-dasharray="${circumference}" stroke-dashoffset="${ringOffset}" style="--offset:${ringOffset}"/>
                        </svg>
                        <div class="daily-ring-center">
                            <div class="daily-ring-percent">${dayProgress}%</div>
                            <div class="daily-ring-label">Today</div>
                        </div>
                    </div>
                    <div class="daily-ring-info">
                        <div class="daily-ring-title">${ringComplete?'ğŸ‰ Ring Closed!':'Close Your Ring'}</div>
                        <div class="daily-ring-subtitle">${ringComplete?'Amazing work today!':'Complete all tasks & habits'}</div>
                        <div class="daily-ring-stats">
                            <div class="daily-ring-stat"><strong>${completedItems}</strong>/${totalItems} done</div>
                            <div class="daily-ring-stat">${Icons.flame} <strong>${streak}</strong> day streak</div>
                        </div>
                    </div>
                </div>
                
                <!-- TODAY'S TASK - NOW AT TOP -->
                <div class="section-header"><span class="section-title">Today's Task</span><span class="section-action" id="view-plan">View Plan ${Icons.chevronRight}</span></div>
                ${todayTask?`<div class="task-card ${taskDone?'completed':''}"><div class="task-header"><div class="task-check ${taskDone?'done':''}" data-complete-task="${todayTaskId}">${Icons.check}</div><div class="task-content"><div class="task-text">${todayTask.task}</div><div class="task-meta"><span class="task-tag ai">Week ${cw}</span></div></div></div>${!taskDone?`<div class="task-actions"><button class="task-btn cant-start" data-2min-task="${todayTaskId}" data-task="${todayTask.task}" ${twoMinLoading?'disabled':''}>${twoMinLoading?'<span class="mini-spinner"></span>':Icons.zap} Can't Start</button></div>${twoMinOpen?`<div class="two-min-popup"><div class="two-min-badge">${Icons.zap} 2-Minute Version</div><div class="two-min-text">${twoMinOpen.twoMinuteVersion}</div><div class="two-min-why">${twoMinOpen.whyThisWorks}</div><div class="two-min-actions"><button class="task-btn primary" data-complete-task="${todayTaskId}">Did It</button><button class="task-btn" data-close-2min="${todayTaskId}">Dismiss</button></div></div>`:''}`:''}}</div>`:`<div class="task-card" style="text-align:center;color:var(--text3);padding:24px;">No task for today</div>`}
                
                <!-- HABITS - RIGHT AFTER TASKS -->
                <div class="section-header" style="margin-top:20px;"><span class="section-title">Daily Habits</span></div>
                ${this.data.habits.length===0?`<p style="text-align:center;color:var(--text3);padding:20px;">No habits yet</p>`:this.data.habits.map(h=>{
                    const isDone = this.data.completions.some(c=>c.odHabitId===h.id&&new Date(c.date).toDateString()===todayStr&&c.completed);
                    const hStreak = this.getHabitStreak(h.id);
                    const h2m = this.state.twoMinOpen[h.id], h2ml = this.state.twoMinLoading[h.id];
                    return `<div class="habit-card ${isDone?'completed':''}"><div class="habit-row"><div class="habit-check ${isDone?'done':''}" data-complete-habit="${h.id}">${Icons.check}</div><div class="habit-info"><div class="habit-name">${h.name}</div><div class="habit-meta">${h.goalAmount} ${h.unit}</div></div>${hStreak>0?`<div class="habit-streak">${Icons.flame} ${hStreak}</div>`:''} ${!isDone?`<button class="habit-2min" data-2min-habit="${h.id}" data-habit-name="${h.name}" data-habit-amount="${h.goalAmount}" data-habit-unit="${h.unit}" ${h2ml?'disabled':''}>${h2ml?'...':Icons.zap}</button>`:''}</div>${h2m?`<div class="two-min-popup" style="margin-top:12px;"><div class="two-min-badge">${Icons.zap} 2-Minute Version</div><div class="two-min-text">${h2m.twoMinuteVersion}</div><div class="two-min-why">${h2m.whyThisWorks}</div><div class="two-min-actions"><button class="task-btn primary" data-complete-habit="${h.id}">Did It</button><button class="task-btn" data-close-2min="${h.id}">Dismiss</button></div></div>`:''}</div>`;
                }).join('')}
                <button class="add-btn" id="add-habit-main">${Icons.plus} Add Habit</button>
                
                <!-- MOUNTAIN ASCENT WITH GOAL - AT BOTTOM -->
                <div class="section-header" style="margin-top:24px;"><span class="section-title">Your Journey</span></div>
                ${mountainHtml}
                
                <!-- HEATMAP -->
                ${heatmapHtml}
            `;
        },
        
        renderHeatmap() {
            const today = new Date();
            const year = today.getFullYear(), month = today.getMonth();
            const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month+1, 0).getDate();
            
            let cells = '';
            // Empty cells for days before month starts
            for(let i=0;i<firstDay;i++) cells += '<div class="calendar-cell empty"></div>';
            
            // Cells for each day
            for(let day=1;day<=daysInMonth;day++){
                const d = new Date(year,month,day);
                const isToday = d.toDateString()===today.toDateString();
                const isFuture = d > today;
                const dayCompletions = this.data.completions.filter(c=>new Date(c.date).toDateString()===d.toDateString()&&c.completed);
                const total = this.data.habits.length||1;
                const done = new Set(dayCompletions.map(c=>c.odHabitId)).size;
                const pct = Math.round((done/total)*100);
                const isComplete = pct >= 100;
                
                // Ring math (radius 16, so circumference = 2*PI*16 â‰ˆ 100)
                const circumference = 100;
                const offset = circumference - (pct/100)*circumference;
                
                // Format date as MM/DD
                const dateStr = `${month+1}/${day.toString().padStart(2,'0')}`;
                const tooltip = `${monthNames[month]} ${day}: ${done}/${total} (${pct}%)`;
                
                cells += `<div class="calendar-cell ${isToday?'today':''} ${isComplete?'complete':''}">
                    <div class="calendar-cell-ring ${isFuture?'future':''} ${isToday?'today':''} ${isComplete?'complete':''}">
                        <svg viewBox="0 0 40 40">
                            <circle class="ring-bg" cx="20" cy="20" r="16"/>
                            ${!isFuture?`<circle class="ring-fill" cx="20" cy="20" r="16" stroke-dasharray="${circumference}" stroke-dashoffset="${offset}"/>`:''} 
                        </svg>
                    </div>
                    <div class="calendar-cell-date">${dateStr}</div>
                    ${!isFuture?`<div class="calendar-tooltip">${tooltip}</div>`:''}
                </div>`;
            }
            
            return `<div class="heatmap-card">
                <div class="heatmap-header">
                    <div class="heatmap-title">${monthNames[month]} ${year}</div>
                    <div class="heatmap-legend"><span style="font-size:10px;color:var(--text3);">Ring = % complete</span></div>
                </div>
                <div class="heatmap-days-header"><span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span></div>
                <div class="calendar-grid">${cells}</div>
            </div>`;
        },
        
        renderMountain() {
            const streak = this.data.streakDays;
            const maxDay = 60;
            const pct = Math.min(streak/maxDay, 1);
            const goal = this.data.goal || "Your Goal";
            
            // Truncate goal for display
            const goalShort = goal.length > 40 ? goal.substring(0, 37) + '...' : goal;
            
            // Path from base (left) to summit (right) - continuous line
            // Start at (20, 160), end at (280, 25)
            const startX = 20, startY = 160;
            const endX = 280, endY = 25;
            
            // Calculate climber position proportionally along the path
            // Day 1 = 1/60 of the way, Day 30 = halfway, Day 60 = at summit
            const climberX = startX + (endX - startX) * pct;
            const climberY = startY + (endY - startY) * pct;
            
            // Calculate walked path length
            const walkedPathD = pct > 0 ? `M${startX},${startY} L${climberX},${climberY}` : '';
            
            // Milestone positions along the path
            const getMilestonePos = (day) => {
                const p = Math.min(day/maxDay, 1);
                return {
                    x: startX + (endX - startX) * p,
                    y: startY + (endY - startY) * p
                };
            };
            
            // Determine current and unlocked camps
            const camps = MILESTONES.map((m,i) => ({
                ...m,
                pos: getMilestonePos(m.day),
                unlocked: streak >= m.day,
                current: streak >= m.day && (i===MILESTONES.length-1 || streak < MILESTONES[i+1].day)
            }));
            
            return `<div class="mountain-card">
                <div class="mountain-header">
                    <div class="mountain-title">ğŸ”ï¸ Your Ascent</div>
                    <div class="mountain-progress-text">Day ${streak} of ${maxDay}<button class="info-btn" id="show-60days-info">${Icons.info}</button></div>
                </div>
                <div class="mountain-visual">
                    <svg class="mountain-svg" viewBox="0 0 300 180">
                        <defs>
                            <linearGradient id="skyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#bfdbfe"/>
                                <stop offset="100%" style="stop-color:#e0f2fe"/>
                            </linearGradient>
                            <linearGradient id="mtGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#64748b"/>
                                <stop offset="40%" style="stop-color:#94a3b8"/>
                                <stop offset="100%" style="stop-color:#cbd5e1"/>
                            </linearGradient>
                        </defs>
                        <!-- Sky -->
                        <rect fill="url(#skyGrad)" width="300" height="180"/>
                        <!-- Mountain -->
                        <polygon fill="url(#mtGrad)" points="0,180 60,100 100,130 150,20 200,80 250,50 300,100 300,180"/>
                        <!-- Snow cap -->
                        <polygon fill="#f1f5f9" points="140,35 150,20 160,35"/>
                        <!-- Full path (dashed) -->
                        <path class="mountain-path" d="M${startX},${startY} L${endX},${endY}"/>
                        <!-- Walked path (solid) -->
                        ${walkedPathD ? `<path class="mountain-path-walked" d="${walkedPathD}"/>` : ''}
                        <!-- Milestone markers -->
                        ${camps.map(c => `
                            <g class="camp-marker ${c.unlocked?'unlocked':''} ${c.current?'current':''}" transform="translate(${c.pos.x},${c.pos.y})">
                                <circle r="6" fill="${c.unlocked?'#22c55e':'#e2e8f0'}" stroke="#fff" stroke-width="2"/>
                            </g>
                        `).join('')}
                        <!-- Goal flag at summit -->
                        <g transform="translate(${endX},${endY})">
                            <line x1="0" y1="0" x2="0" y2="-30" stroke="#f59e0b" stroke-width="2"/>
                            <polygon points="0,-30 20,-25 0,-20" fill="#f59e0b"/>
                            <text x="5" y="-32" font-size="7" font-weight="700" fill="#0f172a">ğŸ† GOAL</text>
                        </g>
                        <!-- Climber icon -->
                        ${streak > 0 ? `
                        <g class="climber-icon" transform="translate(${climberX},${climberY})">
                            <circle r="8" fill="#3b82f6" stroke="#fff" stroke-width="2"/>
                            <text y="4" text-anchor="middle" font-size="10">ğŸ§—</text>
                        </g>
                        ` : `
                        <g class="climber-icon" transform="translate(${startX},${startY})">
                            <circle r="8" fill="#3b82f6" stroke="#fff" stroke-width="2"/>
                            <text y="4" text-anchor="middle" font-size="10">ğŸ§—</text>
                        </g>
                        `}
                        <!-- Start label -->
                        <text x="${startX}" y="${startY + 15}" font-size="8" font-weight="600" fill="#64748b" text-anchor="middle">Start</text>
                    </svg>
                </div>
                <!-- Goal display below mountain -->
                <div style="background:linear-gradient(135deg, var(--accent-light), var(--purple-light)); border-radius:var(--radius); padding:14px 16px; margin-top:12px;">
                    <div style="font-size:11px; font-weight:700; color:var(--accent); text-transform:uppercase; margin-bottom:4px;">ğŸ¯ Your Goal</div>
                    <div style="font-size:14px; font-weight:600; color:var(--text); line-height:1.4;">${goalShort}</div>
                </div>
                <!-- Milestone legend -->
                <div class="mountain-legend">${camps.map(c=>`
                    <div class="mountain-camp ${c.unlocked?'unlocked':''} ${c.current?'current':''}">
                        <div class="mountain-camp-icon ${c.unlocked?'unlocked':''} ${c.current?'current':'locked'}">${c.icon}</div>
                        <div class="mountain-camp-name">${c.name}</div>
                        <div class="mountain-camp-day">Day ${c.day}</div>
                    </div>
                `).join('')}</div>
            </div>`;
        },
        
        planTab() {
            const c = this.data.curriculum;
            if(!c) return '<p style="text-align:center;color:var(--text3);padding:40px;">No curriculum yet.</p>';
            return `<div class="curriculum-card"><div class="curriculum-header"><div class="curriculum-icon">${Icons.award}</div><div><div class="curriculum-title">${c.title}</div><div class="curriculum-meta">Week ${this.data.currentWeek} of ${c.totalWeeks}</div></div></div>${c.phases.map(p=>`<div class="phase"><div class="phase-header"><div class="phase-dot"></div><div class="phase-name">${p.name}</div></div><div class="phase-weeks">${p.weeks.map(w=>`<div class="week-item" style="${w.week===this.data.currentWeek?'background:var(--accent-light);margin:-10px -12px;padding:10px 12px;border-radius:8px;':''}"><div class="week-num" style="${w.week===this.data.currentWeek?'color:var(--accent);':''}">Week ${w.week} ${w.week===this.data.currentWeek?'â† Current':''}</div><div class="week-milestone">${w.milestone}</div></div>`).join('')}</div></div>`).join('')}</div><button class="btn btn-primary btn-full" id="view-week-plan">View This Week</button>`;
        },
        
        profileTab() {
            const badges = MILESTONES.filter(m=>this.data.streakDays>=m.day);
            return `<div style="text-align:center;padding:32px 0;"><div class="header-avatar" style="width:80px;height:80px;font-size:32px;margin:0 auto 16px;">${(this.data.name||'U')[0].toUpperCase()}</div><div style="font-size:24px;font-weight:700;">${this.data.name||'Climber'}</div><div style="color:var(--text3);margin-top:4px;">Week ${this.data.currentWeek}</div></div><div class="plan-card"><div class="plan-header"><div class="plan-icon" style="background:var(--success-light);">${Icons.flame}</div><div><div class="plan-title">${this.data.streakDays} Day Streak</div><div class="plan-meta">${60-this.data.streakDays} to autopilot</div></div></div></div><div class="section-header"><span class="section-title">Badges Earned</span></div><div style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:20px;">${badges.map(b=>`<div style="text-align:center;padding:12px;background:var(--card);border-radius:12px;box-shadow:var(--shadow);"><div style="font-size:24px;">${b.icon}</div><div style="font-size:11px;font-weight:600;color:var(--text3);margin-top:4px;">${b.name}</div></div>`).join('')}</div><button class="btn btn-light btn-full" id="reset-data" style="margin-top:16px;color:var(--danger);">Reset All Data</button>`;
        },
        
        celebrationOverlay() {
            return `<div class="celebration" id="celebration"><div class="celebration-icon">${Icons.check}</div><div class="celebration-title">Done!</div><div class="celebration-sub">Keep the momentum</div></div>`;
        },
        
        milestoneModal() {
            const m = this.state.showMilestone;
            if(!m) return '';
            return `<div class="milestone-modal active" id="milestone-modal"><div class="milestone-content"><div class="milestone-badge" style="font-size:60px;">${m.icon}</div><div class="milestone-title">${m.name} Reached!</div><div class="milestone-subtitle">${m.message}</div><button class="btn btn-primary milestone-btn" id="close-milestone">Continue</button></div></div>`;
        },
        
        info60DaysModal() {
            if(!this.state.show60DaysInfo) return '';
            return `<div class="info-modal active" id="info-60days-modal"><div class="info-modal-content"><div class="info-modal-header"><div class="info-modal-icon">ğŸ§ </div><div class="info-modal-title">Why 60 Days?</div></div><div class="info-modal-body"><p>Research by Dr. Phillippa Lally at UCL found that it takes an <strong>average of 66 days</strong> for a new behavior to become automaticâ€”what we call "autopilot."</p><p>The range varies widely (18â€“254 days) depending on the habit's complexity. Simple habits like drinking water form faster; harder ones like daily exercise take longer.</p><p>Good news: <strong>missing a single day doesn't reset your progress.</strong> Consistency matters more than perfection.</p><p>We use 60 days as a clean target that's in the ballparkâ€”close enough to be scientifically grounded, round enough to feel achievable.</p></div><div class="info-modal-source">Source: Lally et al. (2010), European Journal of Social Psychology</div><button class="btn btn-primary info-modal-close" id="close-60days-info">Got It</button></div></div>`;
        },
        
        getHabitStreak(habitId) {
            const today = new Date();
            let streak = 0;
            for(let i=0;i<365;i++){
                const d = new Date(today); d.setDate(today.getDate()-i);
                const done = this.data.completions.some(c=>c.odHabitId===habitId&&new Date(c.date).toDateString()===d.toDateString()&&c.completed);
                if(i===0&&!done) continue;
                if(done) streak++; else break;
            }
            return streak;
        },
        
        checkMilestones() {
            const streak = this.data.streakDays;
            for(const m of MILESTONES) {
                if(streak>=m.day && !this.data.unlockedMilestones.includes(m.day)) {
                    this.data.unlockedMilestones.push(m.day);
                    this.state.showMilestone = m;
                    this.saveData();
                    Particles.confetti();
                    break;
                }
            }
        },
        
        async generateCurriculum() {
            this.state.generating = true; this.render();
            const result = await AscentAI.generateCurriculum({goal:this.data.goal,weeksAvailable:this.data.weeksAvailable,currentLevel:this.data.currentLevel,context:this.data.goalContext});
            this.data.curriculum = result;
            this.state.generating = false;
            this.saveData(); this.render();
        },
        
        async generateDailyTasks() {
            this.state.generating = true; this.render();
            let wm = "Complete goals";
            if(this.data.curriculum) for(const p of this.data.curriculum.phases){ const w=p.weeks.find(w=>w.week===this.data.currentWeek); if(w){wm=w.milestone;break;}}
            const result = await AscentAI.generateDailyTasks({milestone:wm,daysAvailable:7,goalContext:this.data.goal});
            this.data.dailyTasks = result.tasks;
            this.state.generating = false;
            this.saveData(); this.render();
        },
        
        async generate2MinTask(taskId, taskText) {
            this.state.twoMinLoading[taskId] = true; this.render();
            const result = await AscentAI.generateTwoMinute({task:taskText});
            this.state.twoMinLoading[taskId] = false;
            this.state.twoMinOpen[taskId] = result;
            this.render();
        },
        
        async generate2MinHabit(habitId, habitName, goalAmount, unit) {
            this.state.twoMinLoading[habitId] = true; this.render();
            const result = await AscentAI.generateTwoMinuteHabit({habitName,goalAmount,unit});
            this.state.twoMinLoading[habitId] = false;
            this.state.twoMinOpen[habitId] = result;
            this.render();
        },
        
        completeTask(taskId, el) {
            if(!this.data.taskCompletions.includes(taskId)) {
                this.data.taskCompletions.push(taskId);
                this.data.streakDays = Math.max(this.data.streakDays, 1);
                delete this.state.twoMinOpen[taskId];
                if(el) { const rect = el.getBoundingClientRect(); Particles.explode(rect.left+13, rect.top+13); }
                this.checkMilestones();
                this.saveData();
                this.showCelebration();
            }
        },
        
        completeHabit(habitId, el) {
            const today = new Date().toISOString();
            if(!this.data.completions.find(c=>c.odHabitId===habitId&&new Date(c.date).toDateString()===new Date().toDateString())) {
                this.data.completions.push({odHabitId:habitId,date:today,completed:true});
                this.data.streakDays = Math.max(this.data.streakDays, 1);
                delete this.state.twoMinOpen[habitId];
                if(el) { const rect = el.getBoundingClientRect(); Particles.explode(rect.left+12, rect.top+12); }
                this.checkMilestones();
                this.saveData();
                this.showCelebration();
            }
        },
        
        showCelebration() {
            const el = document.getElementById('celebration');
            if(el) { el.classList.add('active'); setTimeout(()=>{el.classList.remove('active');this.render();},1500); }
        },
        
        attachEvents() {
            // Onboarding
            document.getElementById('onboarding-next')?.addEventListener('click',()=>{const n=document.getElementById('name-input')?.value.trim();if(n){this.data.name=n;this.state.screen='setup-goal';this.render();}else{this.state.screen='setup-goal';this.render();}});
            
            // Setup
            document.getElementById('goal-back')?.addEventListener('click',()=>{this.state.screen='onboarding';this.render();});
            document.getElementById('goal-next')?.addEventListener('click',()=>{const g=document.getElementById('goal-input')?.value.trim();if(g){this.data.goal=g;this.state.screen='setup-context';this.render();}});
            document.querySelectorAll('[data-level]').forEach(el=>el.addEventListener('click',()=>{this.data.currentLevel=el.dataset.level;this.render();}));
            document.querySelectorAll('[data-weeks]').forEach(el=>el.addEventListener('click',()=>{this.data.weeksAvailable=parseInt(el.dataset.weeks);this.render();}));
            document.getElementById('context-back')?.addEventListener('click',()=>{this.state.screen='setup-goal';this.render();});
            document.getElementById('context-next')?.addEventListener('click',()=>{this.data.goalContext=document.getElementById('context-input')?.value||'';this.state.screen='setup-curriculum';this.generateCurriculum();});
            document.querySelectorAll('.time-chip').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('.time-chip').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');}));
            document.getElementById('curriculum-back')?.addEventListener('click',()=>{this.state.screen='setup-context';this.render();});
            document.getElementById('curriculum-next')?.addEventListener('click',()=>{if(this.data.curriculum){this.state.screen='setup-habits';this.render();}});
            document.getElementById('habits-back')?.addEventListener('click',()=>{this.state.screen='setup-curriculum';this.render();});
            document.getElementById('add-habit-btn')?.addEventListener('click',()=>{const n=document.getElementById('habit-name-input')?.value.trim(),a=parseInt(document.getElementById('habit-amount-input')?.value)||30,u=document.getElementById('habit-unit-input')?.value||'minutes';if(n){this.data.habits.push({id:Date.now().toString(),name:n,goalAmount:a,unit:u});document.getElementById('habit-name-input').value='';this.render();}});
            document.querySelectorAll('[data-remove-habit]').forEach(el=>el.addEventListener('click',()=>{this.data.habits.splice(parseInt(el.dataset.removeHabit),1);this.render();}));
            document.getElementById('habits-done')?.addEventListener('click',()=>{this.data.streakDays=1;this.data.unlockedMilestones=[1];this.saveData();this.state.screen='weekly-plan';this.generateDailyTasks();});
            document.getElementById('plan-back')?.addEventListener('click',()=>{this.state.screen='app';this.render();});
            document.getElementById('plan-done')?.addEventListener('click',()=>{this.state.screen='app';this.render();});
            
            // Tabs
            document.querySelectorAll('.tab-item').forEach(t=>t.addEventListener('click',()=>{this.state.activeTab=t.dataset.tab;this.render();}));
            
            // Actions
            document.getElementById('view-plan')?.addEventListener('click',()=>{this.state.screen='weekly-plan';this.render();});
            document.getElementById('view-week-plan')?.addEventListener('click',()=>{this.state.screen='weekly-plan';this.render();});
            
            // Complete
            document.querySelectorAll('[data-complete-task]').forEach(el=>el.addEventListener('click',()=>this.completeTask(el.dataset.completeTask,el)));
            document.querySelectorAll('[data-complete-habit]').forEach(el=>el.addEventListener('click',()=>this.completeHabit(el.dataset.completeHabit,el)));
            
            // 2-min
            document.querySelectorAll('[data-2min-task]').forEach(el=>el.addEventListener('click',()=>this.generate2MinTask(el.dataset['2minTask'],el.dataset.task)));
            document.querySelectorAll('[data-2min-habit]').forEach(el=>el.addEventListener('click',()=>this.generate2MinHabit(el.dataset['2minHabit'],el.dataset.habitName,el.dataset.habitAmount,el.dataset.habitUnit)));
            document.querySelectorAll('[data-close-2min]').forEach(el=>el.addEventListener('click',()=>{delete this.state.twoMinOpen[el.dataset.close2min];this.render();}));
            
            // Habits
            document.getElementById('add-habit-main')?.addEventListener('click',()=>{const n=prompt('Habit name:');if(n){this.data.habits.push({id:Date.now().toString(),name:n,goalAmount:30,unit:'minutes'});this.saveData();this.render();}});
            
            // Milestone modal
            document.getElementById('close-milestone')?.addEventListener('click',()=>{this.state.showMilestone=null;this.render();});
            
            // 60 days info modal
            document.getElementById('show-60days-info')?.addEventListener('click',()=>{this.state.show60DaysInfo=true;this.render();});
            document.getElementById('close-60days-info')?.addEventListener('click',()=>{this.state.show60DaysInfo=false;this.render();});
            document.getElementById('info-60days-modal')?.addEventListener('click',(e)=>{if(e.target.id==='info-60days-modal'){this.state.show60DaysInfo=false;this.render();}});
            
            // Reset
            document.getElementById('reset-data')?.addEventListener('click',()=>{if(confirm('Reset?')){localStorage.removeItem('ascent_v10');location.reload();}});
        }
    };
    
    App.init();
    </script>
</body>
</html>
